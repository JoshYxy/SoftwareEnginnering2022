{"ast":null,"code":"import { Check, Upload } from \"@element-plus/icons\";\nimport axios from 'axios';\nimport { validName, validPhone, validPassport, validEmail } from './jsComponents/CheckRules'; //格式检查\n\nexport default {\n  name: 'AdminControl',\n  components: {\n    Check,\n    Upload\n  },\n\n  data() {\n    return {\n      collegeData: [{\n        id: 1,\n        name: '计算机科学技术学院',\n        majors: [{\n          id: 1,\n          name: '大数据'\n        }, {\n          id: 2,\n          name: '信息安全'\n        }]\n      }, {\n        id: 1,\n        name: '生命科学学院',\n        majors: [{\n          id: 1,\n          name: '生物'\n        }, {\n          id: 2,\n          name: '123'\n        }]\n      }, {\n        id: 1,\n        name: '软件工程学院',\n        majors: [{\n          id: 1,\n          name: '软件工程'\n        }]\n      }],\n      majorData: [],\n      userData: {\n        number: null,\n        role: 'student',\n        name: '',\n        id: '',\n        phone: '',\n        email: '',\n        stu_id: null,\n        teach_id: null,\n        password: '123456',\n        major: '',\n        college: {}\n      },\n      collegeBackup: {},\n      majorBackup: '',\n      rules: {\n        college: [{\n          required: true,\n          message: '请选择学院',\n          trigger: 'change'\n        }],\n        major: [{\n          required: true,\n          message: '请选择专业',\n          trigger: 'change'\n        }],\n        role: [{\n          required: true,\n          message: '请选择身份',\n          trigger: 'change'\n        }],\n        stu_id: [{\n          required: true,\n          message: '学号不能为空',\n          trigger: 'blur'\n        }, {\n          pattern: /^\\d{6,6}$/,\n          message: '学号为6位数字',\n          trigger: 'blur'\n        }, {\n          pattern: /^[0-1][0-9][0-9]*$|^2[0-2][0-9]*$/,\n          message: '学号必须为注册年份后两位开头的数字(小于22)'\n        }],\n        teach_id: [{\n          required: true,\n          message: '工号不能为空',\n          trigger: 'blur'\n        }, {\n          pattern: /^\\d{8,8}$/,\n          message: '工号为8位数字',\n          trigger: 'blur'\n        }, {\n          pattern: /^[0-1][0-9][0-9]*$|^2[0-2][0-9]*$/,\n          message: '工号必须为注册年份后两位开头的数字(小于22)'\n        }],\n        name: [{\n          required: true,\n          message: '姓名不能为空',\n          trigger: 'blur'\n        }, {\n          validator: validName,\n          trigger: ['blur', 'change']\n        }],\n        id: [{\n          required: true,\n          message: '身份证不能为空',\n          trigger: 'blur'\n        }, {\n          validator: validPassport,\n          trigger: 'blur'\n        }],\n        phone: [{\n          required: false,\n          trigger: ['blur', 'change']\n        }, {\n          validator: validPhone,\n          trigger: 'blur'\n        }],\n        email: [{\n          required: false,\n          trigger: 'blur'\n        }, {\n          validator: validEmail,\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n\n  watch: {\n    //如果没有.name会出错，因为在college = college.name赋值中改变了college，但不会认为college.name改变（此时不希望watch被触发）    \n    \"userData.college.name\": {\n      handler() {\n        // console.log(this.userData.college)\n        this.userData.major = '';\n      }\n\n    }\n  },\n  methods: {\n    submit() {\n      const name = '';\n      this.$refs['userData'].validate(async valid => {\n        if (valid) {\n          if (this.userData.role == 'student') this.userData.number = this.userData.stu_id;\n          if (this.userData.role == 'teacher') this.userData.number = this.userData.teach_id;\n          this.collegeBackup = this.userData.college;\n          this.majorBackup = this.userData.major;\n          name = this.userData.college.name;\n          this.userData.college = name;\n          console.log(this.userData); // axios.post('http://localhost:8081/register', null, {params:this.userData})\n          // await axios.post('http://localhost:8081/admin/new', this.userData)\n          //   .then(function(resp){\n          //     console.log(resp)\n          //     alert('提交成功')\n          //   }).catch(error => {\n          //     if(error.response.status == 421){\n          //       if(this.userData.role == 'student')\n          //         alert('学号已存在')\n          //       else\n          //         alert('工号已存在')\n          //       this.userData.stu_id = ''\n          //       this.userData.teach_id = ''\n          //     }\n          //     if(error.response.status == 420){\n          //       alert('身份证已存在');\n          //       this.userData.id = ''\n          //     }\n          //     console.dir(error);\n          //   })\n\n          console.log(this.userData);\n          this.userData.college = this.collegeBackup;\n          this.userData.major = this.majorBackup;\n        } else {\n          console.log('error ssssubmit');\n          return false;\n        }\n      });\n    },\n\n    onBeforeUpload(file) {\n      const isCSV = file.type === 'application/vnd.ms-excel';\n\n      if (!isCSV) {\n        this.$message.error('上传文件只能是.csv格式!');\n      }\n\n      return isCSV;\n    },\n\n    Upload(file) {\n      let param = new FormData();\n      param.append('file', file);\n      axios.post(\"http://localhost:8081/admin/users\", param).then(function () {\n        alert('批量导入信息完成，无导入失败');\n      }).catch(error => {\n        alert(error.response.message);\n      });\n    }\n\n  },\n\n  async created() {\n    await axios.get(\"http://localhost:8081/admin/edu\").then(res => {\n      this.collegeData = res.data.data;\n\n      for (let i in this.collegeData) {\n        //替换变量名,对应后端数据\n        this.collegeData[i] = JSON.parse(JSON.stringify(this.collegeData[i]).replace(/collegeVOId/g, \"id\"));\n        this.collegeData[i] = JSON.parse(JSON.stringify(this.collegeData[i]).replace(/majorId/g, \"id\"));\n        this.collegeData[i] = JSON.parse(JSON.stringify(this.collegeData[i]).replace(/collegeVOName/g, \"name\"));\n        this.collegeData[i] = JSON.parse(JSON.stringify(this.collegeData[i]).replace(/majorName/g, \"name\"));\n      }\n    }).catch(error => {\n      alert('获取服务器信息失败');\n      console.dir(error);\n    });\n  }\n\n};","map":{"version":3,"mappings":"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","names":["Check","Upload","axios","validName","validPhone","validPassport","validEmail","name","components","data","collegeData","id","majors","majorData","userData","number","role","phone","email","stu_id","teach_id","password","major","college","collegeBackup","majorBackup","rules","required","message","trigger","pattern","validator","watch","handler","methods","submit","$refs","validate","valid","console","log","onBeforeUpload","file","isCSV","type","$message","error","param","FormData","append","post","then","alert","catch","response","created","get","res","i","JSON","parse","stringify","replace","dir"],"sourceRoot":"","sources":["D:\\fdu\\software_engineering\\Lab\\5-Lab\\front_end\\src\\components\\AdminControl.vue"],"sourcesContent":["<template>\r\n  <div class=\"admin\" style=\"margin:0px auto\">\r\n    <h1>信息录入</h1>\r\n    <el-upload\r\n      class=\"upload-demo\"\r\n      :action=\"Upload\"\r\n      accept=\".csv\"\r\n      :limit=\"1\"\r\n      :before-upload=\"onBeforeUpload\"\r\n      :data=\"uploadData\"\r\n    >\r\n      <el-button type=\"primary\">\r\n        <el-icon style=\"vertical-align: middle;\">\r\n          <upload />\r\n        </el-icon>\r\n        <span style=\"vertical-align: middle;\"> 上传文件 </span>\r\n      </el-button>\r\n<!--      <el-button type=\"primary\">选择文件上传</el-button>-->\r\n      <template #tip>\r\n        <div class=\"el-upload__tip\">\r\n          单个csv文件\r\n        </div>\r\n      </template>\r\n    </el-upload>\r\n    <el-form id=\"admin_container\" ref=\"userData\" :model=\"userData\" :rules=\"rules\" autocomplete=\"on\"  text-align: center>\r\n      <el-form-item prop=\"role\">\r\n        <el-select v-model=\"userData.role\" placeholder=\"角色\">\r\n          <el-option label=\"学生\" value=\"student\"></el-option>\r\n          <el-option label=\"教师\" value=\"teacher\"></el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n\r\n      <el-form-item class=\"college\" prop=\"college\">\r\n        <el-select v-model=\"userData.college\" value-key=\"name\" placeholder=\"学院\">\r\n          <el-option :key=\"colleges.id\" :value=\"colleges\" :label=\"colleges.name\" v-for=\"colleges in collegeData\" ></el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n\r\n      <el-form-item class=\"major\" prop=\"major\" >\r\n        <el-select v-model=\"userData.major\" placeholder=\"专业\">\r\n          <el-option :key=\"major.id\" :value=\"major.name\" :label=\"major.name\" v-for=\"major in userData.college.majors\" ></el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n      \r\n      <el-form-item prop=\"name\">\r\n        <el-input\r\n          type=\"text\"\r\n          name=\"name\"\r\n          v-model=\"userData.name\"\r\n          placeholder=\"姓名\"\r\n        />\r\n      </el-form-item> \r\n\r\n      <el-form-item v-if=\"userData.role==='student'\" prop=\"stu_id\">\r\n        <el-input\r\n          type=\"text\"\r\n          name=\"stu_id\"\r\n          v-model.number=\"userData.stu_id\"\r\n          placeholder=\"学号\"\r\n        />\r\n      </el-form-item>\r\n\r\n      <el-form-item v-if=\"userData.role==='teacher'\" prop=\"teach_id\">\r\n        <el-input\r\n          type=\"text\"\r\n          name=\"teach_id\"\r\n          v-model.number=\"userData.teach_id\"\r\n          placeholder=\"工号\"\r\n        />\r\n      </el-form-item>\r\n\r\n      <el-form-item prop=\"id\">\r\n        <el-input\r\n          name=\"id\"\r\n          v-model=\"userData.id\"\r\n          placeholder=\"身份证号\"\r\n          type=\"text\"\r\n        />\r\n      </el-form-item>\r\n\r\n      <el-form-item prop=\"phone\">\r\n        <el-input\r\n          type=\"text\"\r\n          name=\"phone\"\r\n          v-model=\"userData.phone\"\r\n          placeholder=\"手机号\"\r\n        />\r\n      </el-form-item> \r\n\r\n      <el-form-item prop=\"email\">\r\n        <el-input\r\n          type=\"text\"\r\n          name=\"email\"\r\n          v-model=\"userData.email\"\r\n          placeholder=\"邮箱\"\r\n        />\r\n      </el-form-item>\r\n\r\n      <el-form-item>\r\n        <el-button style=\"display:block;margin:0 auto\" type=\"primary\" @click=\"submit\">\r\n          <el-icon style=\"vertical-align: middle;\">\r\n            <check />\r\n          </el-icon>\r\n          <span style=\"vertical-align: middle;\"> 提交 </span>\r\n        </el-button>\r\n\r\n      </el-form-item>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {Check,Upload} from \"@element-plus/icons\";\r\nimport axios from 'axios'\r\n\r\nimport {validName,validPhone,validPassport,validEmail} from './jsComponents/CheckRules'\r\n//格式检查\r\n\r\nexport default {\r\n\r\n  name: 'AdminControl',\r\n  components:{\r\n    Check,\r\n    Upload\r\n  },\r\n\r\n  data(){\r\n    return {\r\n      collegeData: [\r\n        { \r\n          id: 1,\r\n          name: '计算机科学技术学院', \r\n          majors: [\r\n              {id: 1, name: '大数据'},\r\n              {id: 2, name: '信息安全'}\r\n          ]\r\n        },\r\n        { \r\n          id: 1,\r\n          name: '生命科学学院', \r\n          majors: [\r\n              {id: 1, name: '生物'},\r\n              {id: 2, name: '123'}\r\n          ]\r\n        },\r\n        { \r\n          id: 1,\r\n          name: '软件工程学院', \r\n          majors: [\r\n              {id: 1, name: '软件工程'},\r\n          ]\r\n        },\r\n      ],\r\n      majorData: [\r\n      ],\r\n      userData: {\r\n        number: null,\r\n        role: 'student',\r\n        name: '',\r\n        id: '',\r\n        phone: '',\r\n        email: '',\r\n        stu_id: null,\r\n        teach_id: null,\r\n        password: '123456',\r\n        major: '',\r\n        college: {},\r\n      },\r\n      collegeBackup: {},\r\n      majorBackup: '',\r\n      rules: {\r\n        college: [{required: true, message: '请选择学院', trigger: 'change'}],\r\n        major: [{required: true, message: '请选择专业', trigger: 'change'}],\r\n        role: [{required: true, message: '请选择身份', trigger: 'change'}],\r\n        stu_id: [{required: true, message: '学号不能为空', trigger: 'blur'},\r\n                 {pattern: /^\\d{6,6}$/, message: '学号为6位数字', trigger: 'blur'},\r\n                 {pattern: /^[0-1][0-9][0-9]*$|^2[0-2][0-9]*$/, message: '学号必须为注册年份后两位开头的数字(小于22)'}],\r\n        teach_id: [{required: true, message: '工号不能为空', trigger: 'blur'},\r\n                 {pattern: /^\\d{8,8}$/, message: '工号为8位数字', trigger: 'blur'},\r\n                 {pattern: /^[0-1][0-9][0-9]*$|^2[0-2][0-9]*$/, message: '工号必须为注册年份后两位开头的数字(小于22)'}],\r\n        name: [{required: true, message: '姓名不能为空', trigger: 'blur'},\r\n               {validator: validName, trigger: ['blur', 'change']}],\r\n        id: [{ required: true, message: '身份证不能为空', trigger: 'blur'},\r\n                   { validator: validPassport, trigger: 'blur' }],\r\n        phone: [{required: false, trigger: ['blur', 'change']},\r\n                {validator: validPhone, trigger: 'blur'}],\r\n        email: [{required: false, trigger: 'blur'},\r\n                {validator: validEmail, trigger: 'blur'}],\r\n      }\r\n    }\r\n  },\r\n  watch:{\r\n    //如果没有.name会出错，因为在college = college.name赋值中改变了college，但不会认为college.name改变（此时不希望watch被触发）    \r\n    \"userData.college.name\": {\r\n      handler(){\r\n        // console.log(this.userData.college)\r\n        this.userData.major='';  \r\n      },\r\n    }\r\n  },\r\n  methods:{\r\n    submit(){\r\n      const name = ''\r\n      this.$refs['userData'].validate(async valid => {\r\n        if(valid){\r\n          if(this.userData.role == 'student')\r\n            this.userData.number = this.userData.stu_id\r\n          if(this.userData.role == 'teacher')\r\n            this.userData.number = this.userData.teach_id\r\n          this.collegeBackup = this.userData.college\r\n          this.majorBackup = this.userData.major\r\n          name = this.userData.college.name\r\n          this.userData.college = name\r\n          console.log(this.userData)\r\n          // axios.post('http://localhost:8081/register', null, {params:this.userData})\r\n          // await axios.post('http://localhost:8081/admin/new', this.userData)\r\n          //   .then(function(resp){\r\n          //     console.log(resp)\r\n          //     alert('提交成功')\r\n                \r\n          //   }).catch(error => {\r\n          //     if(error.response.status == 421){\r\n          //       if(this.userData.role == 'student')\r\n          //         alert('学号已存在')\r\n          //       else\r\n          //         alert('工号已存在')\r\n          //       this.userData.stu_id = ''\r\n          //       this.userData.teach_id = ''\r\n          //     }\r\n          //     if(error.response.status == 420){\r\n          //       alert('身份证已存在');\r\n          //       this.userData.id = ''\r\n          //     }\r\n          //     console.dir(error);\r\n          //   })\r\n          console.log(this.userData)\r\n          this.userData.college = this.collegeBackup\r\n          this.userData.major = this.majorBackup\r\n        }\r\n        else{\r\n          console.log('error ssssubmit');\r\n          return false\r\n        }\r\n      })\r\n    },\r\n    onBeforeUpload(file) {\r\n      const isCSV = file.type === 'application/vnd.ms-excel'\r\n\r\n      if (!isCSV) {\r\n        this.$message.error('上传文件只能是.csv格式!');\r\n      }\r\n    \r\n      return isCSV;\r\n    },\r\n    Upload(file) {\r\n      let param = new FormData(); \r\n      param.append('file',file)\r\n      axios.post(\"http://localhost:8081/admin/users\",param)\r\n        .then(function(){\r\n          alert('批量导入信息完成，无导入失败')                  \r\n        }).catch(error => {\r\n          alert(error.response.message)\r\n        })\r\n    }\r\n  },\r\n  async created() {\r\n    await axios.get(\"http://localhost:8081/admin/edu\")\r\n      .then(res => {\r\n        this.collegeData = res.data.data\r\n        for(let i in this.collegeData) {//替换变量名,对应后端数据\r\n          this.collegeData[i] = JSON.parse(JSON.stringify(this.collegeData[i]).replace(/collegeVOId/g,\"id\"))\r\n          this.collegeData[i] = JSON.parse(JSON.stringify(this.collegeData[i]).replace(/majorId/g,\"id\"))\r\n          this.collegeData[i] = JSON.parse(JSON.stringify(this.collegeData[i]).replace(/collegeVOName/g,\"name\"))\r\n          this.collegeData[i] = JSON.parse(JSON.stringify(this.collegeData[i]).replace(/majorName/g,\"name\"))\r\n        }\r\n      }).catch(error => {\r\n        alert('获取服务器信息失败')\r\n        console.dir(error);\r\n      });\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\r\n<style scoped>\r\n.admin{\r\n  position: absolute;\r\n  width: 500px;\r\n  height: 300px;\r\n  margin: auto;\r\n  left: 0;\r\n  right: 0;\r\n}\r\n/* #container {\r\n  border-radius: 15px;\r\n  margin: 0px auto;\r\n  width: 500px;\r\n  padding: 35px 35px;\r\n  background: #fff;\r\n} */\r\n\r\nh3 {\r\n  margin: 40px 0 0;\r\n}\r\n\r\n.college {\r\n  float: left;\r\n  margin-right: 10px;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}