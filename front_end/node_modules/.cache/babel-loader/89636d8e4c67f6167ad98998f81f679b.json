{"ast":null,"code":"import axios from 'axios';\nimport { validName, validPhone, validPassport, validEmail } from './jsComponents/CheckRules'; //格式检查\n\nexport default {\n  name: 'UserinfoMaintenance',\n  props: ['userInfo', 'collegeData', 'major_b'],\n\n  data() {\n    return {\n      dialogFormVisible: false,\n      formLabelWidth: '140px',\n      //与录入信息处相同\n      // this.userInfo,\n      user: {\n        number: null,\n        role: '',\n        name: '',\n        id: '',\n        phone: '',\n        email: '',\n        stu_id: null,\n        teach_id: null,\n        password: '',\n        major: '',\n        college: '',\n        college_: {}\n      },\n      rules: {\n        college: [{\n          required: true,\n          message: '请选择学院',\n          trigger: 'change'\n        }],\n        major: [{\n          required: true,\n          message: '请选择专业',\n          trigger: 'change'\n        }],\n        role: [{\n          required: true,\n          message: '请选择身份',\n          trigger: 'change'\n        }],\n        name: [{\n          required: true,\n          message: '姓名不能为空',\n          trigger: 'blur'\n        }, {\n          validator: validName,\n          trigger: ['blur', 'change']\n        }],\n        id: [{\n          required: true,\n          message: '身份证不能为空',\n          trigger: 'blur'\n        }, {\n          validator: validPassport,\n          trigger: 'blur'\n        }],\n        phone: [{\n          required: false,\n          trigger: ['blur', 'change']\n        }, {\n          validator: validPhone,\n          trigger: 'blur'\n        }],\n        email: [{\n          required: false,\n          trigger: 'blur'\n        }, {\n          validator: validEmail,\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          message: '密码不能为空',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          max: 32,\n          message: '长度为6-32个字符',\n          trigger: ['blur', 'change']\n        }]\n      }\n    };\n  },\n\n  watch: {\n    \"collegeData\": {\n      handler() {\n        for (let i in this.collegeData) {\n          if (this.collegeData[i].name === this.user.college) {\n            console.log('fuck');\n            this.user[\"college_\"] = this.collegeData[i];\n          }\n        }\n      }\n\n    }\n  },\n  methods: {\n    startChange() {\n      this.dialogFormVisible = true; // console.log(this.collegeData)\n      //从数据库获取user信息\n      //或许不用，父组件信息更新，子组件自动更新\n      // for(let i in this.collegeData) {\n      //   if(this.collegeData[i].name === this.user.college){\n      //     this.user.college = this.collegeData[i]\n      //     console.log(1)}\n      // }\n\n      this.user.major = this.userInfo.major; //开始时major会因为college的更新被清除，简单解决方案\n    },\n\n    cancel() {\n      this.dialogFormVisible = false;\n      this.user = JSON.parse(JSON.stringify(this.userInfo));\n\n      for (let i in this.collegeData) {\n        if (this.collegeData[i].name === this.user.college) this.user.college_ = this.collegeData[i];\n      }\n    },\n\n    submit() {\n      this.$refs['user'].validate(valid => {\n        if (valid) {\n          this.user.college = this.user.college_.name;\n          axios.post('http://localhost:8081/admin/user/info', this.user).then(function (resp) {\n            //修改成功关闭修改界面\n            console.log(resp);\n            this.dialogFormVisible = false;\n            this.$emit('changeInfo', this.user);\n\n            for (let i in this.collegeData) {\n              if (this.collegeData[i].name === this.user.college) this.user.college_ = this.collegeData[i];\n            }\n          }).catch(error => {\n            //修改失败留在修改界面\n            if (error.response.status == 420) {\n              alert('身份证已存在');\n              this.userData.id = '';\n            }\n          });\n        } else {\n          console.log('error ssssubmit');\n          return false;\n        }\n      });\n    }\n\n  },\n\n  mounted() {\n    // this.user=this.userInfo\n    this.user = JSON.parse(JSON.stringify(this.userInfo));\n\n    for (let i in this.collegeData) {\n      if (this.collegeData[i].name === this.user.college) {\n        console.log('fuck');\n        this.user[\"college_\"] = this.collegeData[i];\n      } // this.$set(this.user, 'college_', this.collegeData[i])\n\n    }\n\n    this.$watch(\"user.college_.name\", function () {\n      //watch放在这防止major在college初始化时被修改\n      this.user.major = '';\n    });\n    console.log(this.user);\n  }\n\n};","map":{"version":3,"mappings":"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","names":["axios","validName","validPhone","validPassport","validEmail","name","props","data","dialogFormVisible","formLabelWidth","user","number","role","id","phone","email","stu_id","teach_id","password","major","college","college_","rules","required","message","trigger","validator","min","max","watch","handler","i","collegeData","console","log","methods","startChange","userInfo","cancel","JSON","parse","stringify","submit","$refs","validate","valid","post","then","resp","$emit","catch","error","response","status","alert","userData","mounted","$watch"],"sourceRoot":"","sources":["D:\\fdu\\software_engineering\\Lab\\5-Lab\\front_end\\src\\components\\UserinfoMaintenance.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <el-button type=\"text\" @click=\"startChange\"\r\n        >编辑</el-button\r\n    >\r\n\r\n    <el-dialog v-model=\"dialogFormVisible\" title=\"信息修改\" :append-to-body=\"true\" >\r\n      \r\n        <el-form \r\n          id=\"admin_modify\" \r\n          ref=\"user\" \r\n          :model=\"user\" \r\n          :rules=\"rules\" \r\n          autocomplete=\"on\"  \r\n          text-align:center \r\n          :hide-required-asterisk=true\r\n          >\r\n            <el-form-item prop=\"college_\" label=\"学院\">\r\n                <el-select v-model=\"user.college_\" value-key=\"name\" placeholder=\"学院\">\r\n                <el-option :key=\"colleges.id\" :value=\"colleges\" :label=\"colleges.name\" v-for=\"colleges in collegeData\" ></el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n\r\n            <el-form-item prop=\"major\" label=\"专业\">\r\n                <el-select v-model=\"user.major\" placeholder=\"专业\">\r\n                <el-option :key=\"major.id\" :value=\"major.name\" :label=\"major.name\" v-for=\"major in user.college_.majors\" ></el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n            \r\n            <el-form-item prop=\"name\" label=\"姓名\">\r\n                <el-input\r\n                type=\"text\"\r\n                name=\"name\"\r\n                v-model=\"user.name\"\r\n                placeholder=\"姓名\"\r\n                />\r\n            </el-form-item> \r\n\r\n            <el-form-item prop=\"id\" label=\"身份证\">\r\n                <el-input\r\n                name=\"id\"\r\n                v-model=\"user.id\"\r\n                placeholder=\"身份证号\"\r\n                type=\"text\"\r\n                />\r\n            </el-form-item>\r\n\r\n            <el-form-item prop=\"phone\" label=\"手机号\">\r\n                <el-input\r\n                type=\"text\"\r\n                name=\"phone\"\r\n                v-model=\"user.phone\"\r\n                placeholder=\"手机号\"\r\n                />\r\n            </el-form-item> \r\n\r\n            <el-form-item prop=\"email\" label=\"邮箱\">\r\n                <el-input\r\n                type=\"text\"\r\n                name=\"email\"\r\n                v-model=\"user.email\"\r\n                placeholder=\"邮箱\"\r\n                />\r\n            </el-form-item>\r\n            <el-form-item prop=\"password\" label=\"密码\">\r\n                <el-input\r\n                type=\"text\"\r\n                name=\"password\"\r\n                v-model=\"user.password\"\r\n                placeholder=\"密码\"\r\n                />\r\n            </el-form-item>\r\n        </el-form>\r\n        <template #footer>\r\n        <span class=\"dialog-footer\">\r\n            <el-button @click=\"cancel\">取消</el-button>\r\n            <el-button type=\"primary\" @click=\"submit\">确认</el-button>\r\n        </span>\r\n        </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios'\r\nimport {validName,validPhone,validPassport,validEmail} from './jsComponents/CheckRules'//格式检查\r\nexport default {\r\n  name: 'UserinfoMaintenance',\r\n  props: ['userInfo','collegeData','major_b'],\r\n  data() {\r\n    return {\r\n\r\n        dialogFormVisible: false,\r\n        formLabelWidth: '140px',\r\n//与录入信息处相同\r\n        // this.userInfo,\r\n        user: {\r\n          number: null,\r\n          role: '',\r\n          name: '',\r\n          id: '',\r\n          phone: '',\r\n          email: '',\r\n          stu_id: null,\r\n          teach_id: null,\r\n          password: '',\r\n          major: '',\r\n          college: '',\r\n          college_:{}\r\n        },\r\n\r\n        rules: {\r\n            college: [{required: true, message: '请选择学院', trigger: 'change'}],\r\n            major: [{required: true, message: '请选择专业', trigger: 'change'}],\r\n            role: [{required: true, message: '请选择身份', trigger: 'change'}],\r\n            name: [{required: true, message: '姓名不能为空', trigger: 'blur'},\r\n                {validator: validName, trigger: ['blur', 'change']}],\r\n            id: [{ required: true, message: '身份证不能为空', trigger: 'blur'},\r\n                    { validator: validPassport, trigger: 'blur' }],\r\n            phone: [{required: false, trigger: ['blur', 'change']},\r\n                    {validator: validPhone, trigger: 'blur'}],\r\n            email: [{required: false, trigger: 'blur'},\r\n                    {validator: validEmail, trigger: 'blur'}],\r\n            password: [{required: true, message: '密码不能为空', trigger: 'blur'},\r\n                       {min: 6, max: 32, message: '长度为6-32个字符', trigger: ['blur', 'change']}]\r\n        },\r\n    }\r\n  },\r\n  watch:{\r\n    \"collegeData\": {\r\n      handler(){\r\n        for(let i in this.collegeData) {\r\n          if(this.collegeData[i].name === this.user.college){\r\n            console.log('fuck')\r\n            this.user[\"college_\"]=this.collegeData[i]\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n      startChange(){\r\n        this.dialogFormVisible = true\r\n        // console.log(this.collegeData)\r\n        //从数据库获取user信息\r\n        //或许不用，父组件信息更新，子组件自动更新\r\n        // for(let i in this.collegeData) {\r\n          \r\n        //   if(this.collegeData[i].name === this.user.college){\r\n        //     this.user.college = this.collegeData[i]\r\n        //     console.log(1)}\r\n        // }\r\n        this.user.major=this.userInfo.major//开始时major会因为college的更新被清除，简单解决方案\r\n      },\r\n      cancel(){\r\n        this.dialogFormVisible = false\r\n        this.user=JSON.parse(JSON.stringify(this.userInfo))\r\n        for(let i in this.collegeData) {\r\n          if(this.collegeData[i].name === this.user.college)\r\n            this.user.college_ = this.collegeData[i]\r\n        }\r\n      },\r\n      submit(){\r\n      this.$refs['user'].validate(valid => {\r\n        if(valid){\r\n            \r\n            this.user.college = this.user.college_.name\r\n            axios.post('http://localhost:8081/admin/user/info', this.user)\r\n                .then(function(resp){//修改成功关闭修改界面\r\n                  console.log(resp)\r\n                  this.dialogFormVisible = false\r\n                  this.$emit('changeInfo', this.user);  \r\n                  for(let i in this.collegeData) {\r\n                    if(this.collegeData[i].name === this.user.college)\r\n                      this.user.college_ = this.collegeData[i]\r\n                  }                  \r\n                }).catch(error => {//修改失败留在修改界面\r\n                  if(error.response.status == 420){\r\n                    alert('身份证已存在');\r\n                    this.userData.id = ''\r\n                  }\r\n                })\r\n   \r\n        }\r\n        else{\r\n          console.log('error ssssubmit');\r\n          return false\r\n        }\r\n      })\r\n        \r\n    }\r\n  },\r\n  mounted(){\r\n    // this.user=this.userInfo\r\n    this.user=JSON.parse(JSON.stringify(this.userInfo))\r\n    for(let i in this.collegeData) {\r\n      if(this.collegeData[i].name === this.user.college){\r\n        console.log('fuck')\r\n        this.user[\"college_\"]=this.collegeData[i]\r\n      }\r\n        // this.$set(this.user, 'college_', this.collegeData[i])\r\n        \r\n    }\r\n    this.$watch(\"user.college_.name\", function(){//watch放在这防止major在college初始化时被修改\r\n        this.user.major='';  \r\n      }  \r\n    )\r\n    \r\n    console.log(this.user)\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}