{"ast":null,"code":"import { createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, createElementVNode as _createElementVNode } from \"vue\";\n\nconst _hoisted_1 = /*#__PURE__*/_createTextVNode(\"编辑\");\n\nconst _hoisted_2 = {\n  class: \"dialog-footer\"\n};\n\nconst _hoisted_3 = /*#__PURE__*/_createTextVNode(\"取消\");\n\nconst _hoisted_4 = /*#__PURE__*/_createTextVNode(\"确认\");\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n\n  const _component_el_option = _resolveComponent(\"el-option\");\n\n  const _component_el_select = _resolveComponent(\"el-select\");\n\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n\n  const _component_el_input = _resolveComponent(\"el-input\");\n\n  const _component_el_form = _resolveComponent(\"el-form\");\n\n  const _component_el_dialog = _resolveComponent(\"el-dialog\");\n\n  return _openBlock(), _createElementBlock(\"div\", null, [_createVNode(_component_el_button, {\n    type: \"text\",\n    onClick: $options.startChange\n  }, {\n    default: _withCtx(() => [_hoisted_1]),\n    _: 1\n    /* STABLE */\n\n  }, 8\n  /* PROPS */\n  , [\"onClick\"]), _createVNode(_component_el_dialog, {\n    modelValue: $data.dialogFormVisible,\n    \"onUpdate:modelValue\": _cache[7] || (_cache[7] = $event => $data.dialogFormVisible = $event),\n    title: \"信息修改\",\n    \"append-to-body\": true\n  }, {\n    footer: _withCtx(() => [_createElementVNode(\"span\", _hoisted_2, [_createVNode(_component_el_button, {\n      onClick: $options.cancel\n    }, {\n      default: _withCtx(() => [_hoisted_3]),\n      _: 1\n      /* STABLE */\n\n    }, 8\n    /* PROPS */\n    , [\"onClick\"]), _createVNode(_component_el_button, {\n      type: \"primary\",\n      onClick: $options.submit\n    }, {\n      default: _withCtx(() => [_hoisted_4]),\n      _: 1\n      /* STABLE */\n\n    }, 8\n    /* PROPS */\n    , [\"onClick\"])])]),\n    default: _withCtx(() => [_createVNode(_component_el_form, {\n      id: \"admin_modify\",\n      ref: \"user\",\n      model: $data.user,\n      rules: $data.rules,\n      autocomplete: \"on\",\n      \"text-align:center\": \"\",\n      \"hide-required-asterisk\": true\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_form_item, {\n        prop: \"college_\",\n        label: \"学院\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_select, {\n          modelValue: $data.user.college_,\n          \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.user.college_ = $event),\n          \"value-key\": \"name\",\n          placeholder: \"学院\"\n        }, {\n          default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($props.collegeData, colleges => {\n            return _openBlock(), _createBlock(_component_el_option, {\n              key: colleges.id,\n              value: colleges,\n              label: colleges.name\n            }, null, 8\n            /* PROPS */\n            , [\"value\", \"label\"]);\n          }), 128\n          /* KEYED_FRAGMENT */\n          ))]),\n          _: 1\n          /* STABLE */\n\n        }, 8\n        /* PROPS */\n        , [\"modelValue\"])]),\n        _: 1\n        /* STABLE */\n\n      }), _createVNode(_component_el_form_item, {\n        prop: \"major\",\n        label: \"专业\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_select, {\n          modelValue: $data.user.major,\n          \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.user.major = $event),\n          placeholder: \"专业\"\n        }, {\n          default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.user.college_.majors, major => {\n            return _openBlock(), _createBlock(_component_el_option, {\n              key: major.id,\n              value: major.name,\n              label: major.name\n            }, null, 8\n            /* PROPS */\n            , [\"value\", \"label\"]);\n          }), 128\n          /* KEYED_FRAGMENT */\n          ))]),\n          _: 1\n          /* STABLE */\n\n        }, 8\n        /* PROPS */\n        , [\"modelValue\"])]),\n        _: 1\n        /* STABLE */\n\n      }), _createVNode(_component_el_form_item, {\n        prop: \"name\",\n        label: \"姓名\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_input, {\n          type: \"text\",\n          name: \"name\",\n          modelValue: $data.user.name,\n          \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.user.name = $event),\n          placeholder: \"姓名\"\n        }, null, 8\n        /* PROPS */\n        , [\"modelValue\"])]),\n        _: 1\n        /* STABLE */\n\n      }), _createVNode(_component_el_form_item, {\n        prop: \"id\",\n        label: \"身份证\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_input, {\n          name: \"id\",\n          modelValue: $data.user.id,\n          \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $data.user.id = $event),\n          placeholder: \"身份证号\",\n          type: \"text\"\n        }, null, 8\n        /* PROPS */\n        , [\"modelValue\"])]),\n        _: 1\n        /* STABLE */\n\n      }), _createVNode(_component_el_form_item, {\n        prop: \"phone\",\n        label: \"手机号\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_input, {\n          type: \"text\",\n          name: \"phone\",\n          modelValue: $data.user.phone,\n          \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => $data.user.phone = $event),\n          placeholder: \"手机号\"\n        }, null, 8\n        /* PROPS */\n        , [\"modelValue\"])]),\n        _: 1\n        /* STABLE */\n\n      }), _createVNode(_component_el_form_item, {\n        prop: \"email\",\n        label: \"邮箱\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_input, {\n          type: \"text\",\n          name: \"email\",\n          modelValue: $data.user.email,\n          \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => $data.user.email = $event),\n          placeholder: \"邮箱\"\n        }, null, 8\n        /* PROPS */\n        , [\"modelValue\"])]),\n        _: 1\n        /* STABLE */\n\n      }), _createVNode(_component_el_form_item, {\n        prop: \"password\",\n        label: \"密码\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_input, {\n          type: \"text\",\n          name: \"password\",\n          modelValue: $data.user.password,\n          \"onUpdate:modelValue\": _cache[6] || (_cache[6] = $event => $data.user.password = $event),\n          placeholder: \"密码\"\n        }, null, 8\n        /* PROPS */\n        , [\"modelValue\"])]),\n        _: 1\n        /* STABLE */\n\n      })]),\n      _: 1\n      /* STABLE */\n\n    }, 8\n    /* PROPS */\n    , [\"model\", \"rules\"])]),\n    _: 1\n    /* STABLE */\n\n  }, 8\n  /* PROPS */\n  , [\"modelValue\"])]);\n}","map":{"version":3,"mappings":"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","names":["class","_createElementBlock","_createVNode","_component_el_button","type","onClick","$options","_component_el_dialog","$data","$event","title","footer","_createElementVNode","_component_el_form","id","ref","model","rules","autocomplete","_component_el_form_item","prop","label","_component_el_select","college_","placeholder","_Fragment","_renderList","$props","colleges","_createBlock","_component_el_option","key","value","name","major","majors","_component_el_input","phone","email","password"],"sourceRoot":"","sources":["D:\\fdu\\software_engineering\\Lab\\5-Lab\\front_end\\src\\components\\UserinfoMaintenance.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <el-button type=\"text\" @click=\"startChange\"\r\n        >编辑</el-button\r\n    >\r\n\r\n    <el-dialog v-model=\"dialogFormVisible\" title=\"信息修改\" :append-to-body=\"true\" >\r\n      \r\n        <el-form \r\n          id=\"admin_modify\" \r\n          ref=\"user\" \r\n          :model=\"user\" \r\n          :rules=\"rules\" \r\n          autocomplete=\"on\"  \r\n          text-align:center \r\n          :hide-required-asterisk=true\r\n          >\r\n            <el-form-item prop=\"college_\" label=\"学院\">\r\n                <el-select v-model=\"user.college_\" value-key=\"name\" placeholder=\"学院\">\r\n                <el-option :key=\"colleges.id\" :value=\"colleges\" :label=\"colleges.name\" v-for=\"colleges in collegeData\" ></el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n\r\n            <el-form-item prop=\"major\" label=\"专业\">\r\n                <el-select v-model=\"user.major\" placeholder=\"专业\">\r\n                <el-option :key=\"major.id\" :value=\"major.name\" :label=\"major.name\" v-for=\"major in user.college_.majors\" ></el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n            \r\n            <el-form-item prop=\"name\" label=\"姓名\">\r\n                <el-input\r\n                type=\"text\"\r\n                name=\"name\"\r\n                v-model=\"user.name\"\r\n                placeholder=\"姓名\"\r\n                />\r\n            </el-form-item> \r\n\r\n            <el-form-item prop=\"id\" label=\"身份证\">\r\n                <el-input\r\n                name=\"id\"\r\n                v-model=\"user.id\"\r\n                placeholder=\"身份证号\"\r\n                type=\"text\"\r\n                />\r\n            </el-form-item>\r\n\r\n            <el-form-item prop=\"phone\" label=\"手机号\">\r\n                <el-input\r\n                type=\"text\"\r\n                name=\"phone\"\r\n                v-model=\"user.phone\"\r\n                placeholder=\"手机号\"\r\n                />\r\n            </el-form-item> \r\n\r\n            <el-form-item prop=\"email\" label=\"邮箱\">\r\n                <el-input\r\n                type=\"text\"\r\n                name=\"email\"\r\n                v-model=\"user.email\"\r\n                placeholder=\"邮箱\"\r\n                />\r\n            </el-form-item>\r\n            <el-form-item prop=\"password\" label=\"密码\">\r\n                <el-input\r\n                type=\"text\"\r\n                name=\"password\"\r\n                v-model=\"user.password\"\r\n                placeholder=\"密码\"\r\n                />\r\n            </el-form-item>\r\n        </el-form>\r\n        <template #footer>\r\n        <span class=\"dialog-footer\">\r\n            <el-button @click=\"cancel\">取消</el-button>\r\n            <el-button type=\"primary\" @click=\"submit\">确认</el-button>\r\n        </span>\r\n        </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios'\r\nimport {validName,validPhone,validPassport,validEmail} from './jsComponents/CheckRules'//格式检查\r\nexport default {\r\n  name: 'UserinfoMaintenance',\r\n  props: ['userInfo','collegeData','major_b'],\r\n  data() {\r\n    return {\r\n\r\n        dialogFormVisible: false,\r\n        formLabelWidth: '140px',\r\n//与录入信息处相同\r\n        // this.userInfo,\r\n        user: {\r\n          number: null,\r\n          role: '',\r\n          name: '',\r\n          id: '',\r\n          phone: '',\r\n          email: '',\r\n          stu_id: null,\r\n          teach_id: null,\r\n          password: '',\r\n          major: '',\r\n          college: '',\r\n          college_:{}\r\n        },\r\n\r\n        rules: {\r\n            college: [{required: true, message: '请选择学院', trigger: 'change'}],\r\n            major: [{required: true, message: '请选择专业', trigger: 'change'}],\r\n            role: [{required: true, message: '请选择身份', trigger: 'change'}],\r\n            name: [{required: true, message: '姓名不能为空', trigger: 'blur'},\r\n                {validator: validName, trigger: ['blur', 'change']}],\r\n            id: [{ required: true, message: '身份证不能为空', trigger: 'blur'},\r\n                    { validator: validPassport, trigger: 'blur' }],\r\n            phone: [{required: false, trigger: ['blur', 'change']},\r\n                    {validator: validPhone, trigger: 'blur'}],\r\n            email: [{required: false, trigger: 'blur'},\r\n                    {validator: validEmail, trigger: 'blur'}],\r\n            password: [{required: true, message: '密码不能为空', trigger: 'blur'},\r\n                       {min: 6, max: 32, message: '长度为6-32个字符', trigger: ['blur', 'change']}]\r\n        },\r\n    }\r\n  },\r\n  watch:{\r\n    \"collegeData\": {\r\n      handler(){\r\n        for(let i in this.collegeData) {\r\n          if(this.collegeData[i].name === this.user.college){\r\n            console.log('fuck')\r\n            this.user[\"college_\"]=this.collegeData[i]\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n      startChange(){\r\n        this.dialogFormVisible = true\r\n        // console.log(this.collegeData)\r\n        //从数据库获取user信息\r\n        //或许不用，父组件信息更新，子组件自动更新\r\n        // for(let i in this.collegeData) {\r\n          \r\n        //   if(this.collegeData[i].name === this.user.college){\r\n        //     this.user.college = this.collegeData[i]\r\n        //     console.log(1)}\r\n        // }\r\n        this.user.major=this.userInfo.major//开始时major会因为college的更新被清除，简单解决方案\r\n      },\r\n      cancel(){\r\n        this.dialogFormVisible = false\r\n        this.user=JSON.parse(JSON.stringify(this.userInfo))\r\n        for(let i in this.collegeData) {\r\n          if(this.collegeData[i].name === this.user.college)\r\n            this.user.college_ = this.collegeData[i]\r\n        }\r\n      },\r\n      submit(){\r\n      this.$refs['user'].validate(valid => {\r\n        if(valid){\r\n            \r\n            this.user.college = this.user.college_.name\r\n            axios.post('http://localhost:8081/admin/user/info', this.user)\r\n                .then(function(resp){//修改成功关闭修改界面\r\n                  console.log(resp)\r\n                  // this.dialogFormVisible = false\r\n                  this.$emit('changeInfo', this.user);                 \r\n                }).catch(error => {//修改失败留在修改界面\r\n                  console.dir(error)\r\n                  if(error.response.status == 420){\r\n                    alert('身份证已存在');\r\n                    this.userData.id = ''\r\n                  }\r\n                })\r\n   \r\n        }\r\n        else{\r\n          console.log('error ssssubmit');\r\n          return false\r\n        }\r\n      })\r\n        \r\n    }\r\n  },\r\n  mounted(){\r\n    this.user=JSON.parse(JSON.stringify(this.userInfo))\r\n    for(let i in this.collegeData) {\r\n      if(this.collegeData[i].name === this.user.college){\r\n        console.log('fuck')\r\n        this.user[\"college_\"]=this.collegeData[i]\r\n      } \r\n    }\r\n    this.$watch(\"user.college_.name\", function(){//watch放在这防止major在college初始化时被修改\r\n        this.user.major='';  \r\n      }  \r\n    )\r\n    \r\n    console.log(this.user)\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}