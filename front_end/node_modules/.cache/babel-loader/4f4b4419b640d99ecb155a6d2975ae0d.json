{"ast":null,"code":"import axios from 'axios';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nexport default {\n  data() {\n    return {\n      courseOpen: true,\n      courseStatus: '0',\n      onDeleteAll: false,\n      //是否有card进入删除状态\n      onDelete: [false],\n      //特定card是否进入删除教室状态\n      checkGroup: [],\n      startTime: [],\n      endTime: [],\n      newRoom: '',\n      //存放input输入的教室号\n      newCap: '',\n      //存放input输入的教室容量\n      newClassroom: {\n        name: '',\n        aka: '',\n        room: []\n      },\n      //存档select选择的教学楼\n      classroom: [{\n        name: '第三教学楼',\n        aka: 'H3',\n        room: [{\n          name: '301',\n          capacity: '120'\n        }, {\n          name: '402',\n          capacity: '120'\n        }]\n      }, {\n        name: '光华楼西辅楼',\n        aka: 'HGX',\n        room: [{\n          name: '201',\n          capacity: '110'\n        }, {\n          name: '502',\n          capacity: '100'\n        }]\n      }],\n      //存放所有的教学楼及教室号信息\n      buildings: [{\n        id: 1,\n        name: '第三教学楼',\n        aka: 'H3'\n      }, {\n        id: 2,\n        name: '第四教学楼',\n        aka: 'H4'\n      }, {\n        id: 3,\n        name: '光华楼西辅楼',\n        aka: 'HGX'\n      }, {\n        id: 4,\n        name: '第五教学楼',\n        aka: 'H5'\n      }, {\n        id: 5,\n        name: '第六教学楼',\n        aka: 'H6'\n      }]\n    };\n  },\n\n  methods: {\n    courseChange() {\n      axios.post('http://localhost:8081/affair/curriculaVariable', null, {\n        params: {\n          choice: !this.courseOpen\n        }\n      });\n      ElMessage({\n        type: 'success',\n        message: '修改完成'\n      });\n      console.log(this.courseStatus);\n    },\n\n    deleteCourse(index) {\n      this.startTime.splice(index, 1);\n      this.endTime.splice(index, 1);\n    },\n\n    addCourse(index) {\n      this.startTime.splice(index + 1, 0, '');\n      this.endTime.splice(index + 1, 0, '');\n    },\n\n    async addClassroom() {\n      if (this.newRoom === '') {\n        alert('教室号不能为空');\n        return;\n      }\n\n      if (this.newClassroom.name == '') {\n        alert('教学楼不能为空');\n        return;\n      }\n\n      if (this.newCap === '') {\n        alert('教室容量不能为空');\n        return;\n      }\n\n      if (!/^[1-9]\\d*$/.test(this.newCap)) {\n        alert('教室容量为正整数');\n        return;\n      }\n\n      var i;\n      i = this.classroom.findIndex(building => building.name == this.newClassroom.name); //寻找classroom已有的教学楼中是否有newClassroom中的教学楼 \n\n      if (i >= 0) {\n        if (this.classroom[i].room.indexOf(this.newRoom) > -1) {\n          alert('教室已存在，请勿重复添加');\n          this.newRoom = '';\n          return;\n        }\n\n        await axios.post('http://localhost:8081/affair/room/new', {\n          building: this.newClassroom.aka,\n          roomNum: this.newRoom\n        }).then(res => {\n          console.log(res);\n          this.classroom[i].room.push(this.newRoom);\n          this.classroom[i].room.sort((a, b) => {\n            if (a.length < b.length) return -1;else if (a.length > b.length) return 1;else return a.localeCompare(b);\n          }); //将教室号排序\n        });\n      } else {\n        await axios.post('http://localhost:8081/affair/room/new', {\n          building: this.newClassroom.aka,\n          roomNum: this.newRoom\n        }).then(res => {\n          console.log(res);\n          this.newClassroom.room = [];\n          this.newClassroom.room.push(this.newRoom);\n          this.classroom.push(this.newClassroom);\n        });\n      }\n\n      this.newRoom = '';\n    },\n\n    checkDelete(index) {\n      ElMessageBox.confirm('是否删除教学楼‘' + this.classroom[index].name + '’内的全部教室', 'Warning', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.deleteBuilding(index);\n        ElMessage({\n          type: 'success',\n          message: '删除成功'\n        });\n      }).catch(() => {\n        ElMessage({\n          type: 'info',\n          message: '删除取消'\n        });\n      });\n    },\n\n    deleteBuilding(index) {\n      axios.delete('http://localhost:8081/affair/building/rooms', {\n        data: {\n          fullName: this.classroom[index].name,\n          abbrName: this.classroom[index].aka\n        }\n      });\n      this.classroom.splice(index, 1);\n    },\n\n    openDelete(index) {\n      this.onDeleteAll = true;\n      this.onDelete[index] = true;\n      this.checkGroup = [];\n\n      for (let i in this.classroom[index].room) {\n        this.checkGroup.push({\n          name: this.classroom[index].room[i],\n          status: false\n        });\n      }\n\n      console.log(this.checkGroup);\n    },\n\n    async submitDelete(index) {\n      this.onDelete[index] = false;\n      this.onDeleteAll = false;\n\n      for (let i = 0; i < this.checkGroup.length; i++) {\n        if (this.checkGroup[i].status) {\n          await axios.delete('http://localhost:8081/affair/room', {\n            data: {\n              building: this.classroom[index].aka,\n              roomNum: this.classroom[index].room[i]\n            }\n          }).then(res => {\n            console.log(res);\n            this.classroom[index].room.splice(i, 1);\n            this.checkGroup.splice(i, 1);\n          }).catch(err => {\n            console.dir(err);\n          });\n          i = i - 1;\n        }\n      }\n\n      this.checkGroup = [];\n    },\n\n    cancelDelete(index) {\n      this.onDelete[index] = false;\n      this.onDeleteAll = false;\n      this.checkGroup = [];\n    },\n\n    test(index) {\n      // console.log(this.startTime)\n      console.log(index);\n      console.log(this.newClassroom);\n      console.log(this.classroom);\n    },\n\n    submitCourse() {\n      let times = [];\n\n      for (let i = 0; i < this.startTime.length; i++) {\n        if (this.startTime[i] == '' || this.endTime[i] == '') {\n          alert('请填写完所有上课时间后提交');\n          return;\n        }\n\n        times.push({\n          name: '第' + parseInt(i + 1) + '节',\n          startTime: this.startTime[i],\n          endTime: this.endTime[i]\n        });\n      }\n\n      axios.post('http://localhost:8081/affair/times', times).then(res => {\n        console.log(res);\n        ElMessage({\n          type: 'success',\n          message: '提交成功'\n        });\n      });\n    }\n\n  },\n\n  async created() {\n    //获取选课状态\n    axios.get('http://localhost:8081/user/curriculaVariable').then(res => {\n      this.courseStatus = res.data.data1;\n    }).catch(error => {\n      console.dir(error);\n    }); //获取所有教学楼\n\n    axios.get('http://localhost:8081/affair/building').then(res => {\n      this.buildings = res.data.data1;\n\n      for (let i = 0; i < this.buildings.length; i++) {\n        this.buildings[i] = JSON.parse(JSON.stringify(this.buildings[i]).replace(/fullName/g, \"name\"));\n        this.buildings[i] = JSON.parse(JSON.stringify(this.buildings[i]).replace(/abbrName/g, \"aka\"));\n      }\n    });\n    await axios.get('http://localhost:8081/affair').then(res => {\n      console.log(res); //获取教室信息\n\n      let classrooms = res.data.data1;\n      this.classroom = [];\n\n      for (let i = 0; i < classrooms.length; i++) {\n        this.classroom.push({\n          name: classrooms[i].fullName,\n          aka: classrooms[i].abbrName,\n          room: []\n        });\n\n        for (let j = 0; j < classrooms[i].room.length; j++) {\n          this.classroom[i].room.push({\n            name: classrooms[i].room[j].roomNum,\n            capacity: classrooms[i].room[j].capacity\n          });\n        }\n      } //获取上课时间信息\n\n\n      let classTime = res.data.data2;\n      this.startTime = [];\n      this.endTime = [];\n\n      for (let i = 0; i < classTime.length; i++) {\n        this.startTime.push(classTime[i].startTime);\n        this.endTime.push(classTime[i].endTime);\n      }\n    });\n  }\n\n};","map":{"version":3,"mappings":"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","names":["axios","ElMessage","ElMessageBox","data","courseOpen","courseStatus","onDeleteAll","onDelete","checkGroup","startTime","endTime","newRoom","newCap","newClassroom","name","aka","room","classroom","capacity","buildings","id","methods","courseChange","post","params","choice","type","message","console","log","deleteCourse","index","splice","addCourse","addClassroom","alert","test","i","findIndex","building","indexOf","roomNum","then","res","push","sort","a","b","length","localeCompare","checkDelete","confirm","confirmButtonText","cancelButtonText","deleteBuilding","catch","delete","fullName","abbrName","openDelete","status","submitDelete","err","dir","cancelDelete","submitCourse","times","parseInt","created","get","data1","error","JSON","parse","stringify","replace","classrooms","j","classTime","data2"],"sourceRoot":"","sources":["D:\\fdu\\software_engineering\\Lab\\5-Lab\\front_end\\src\\components\\course\\EduMaintenance.vue"],"sourcesContent":["<template>\r\n    <div >\r\n        <h2>选课状态设置</h2>\r\n        <el-radio-group v-model=\"courseStatus\" @change=\"courseChange\">\r\n            <el-radio :label='0'>关闭选课</el-radio>\r\n            <el-radio :label=\"1\">第一轮选课</el-radio>\r\n            <el-radio :label=\"2\">第二轮选课</el-radio>\r\n        </el-radio-group>\r\n\r\n        <!-- <el-switch    \r\n            v-model=\"courseOpen\"\r\n            active-text=\"开始选课\"\r\n            inactive-text=\"停止选课\" \r\n            :before-change=\"courseChange\"/> -->\r\n        <h2>教学时间设置</h2>\r\n        <el-button @click=\"addCourse(-1)\">增加第一节课</el-button>\r\n        <el-button type='primary' @click=\"submitCourse\">提交修改</el-button>\r\n        <div class=\"course-container\" v-for=\"(item, index) in startTime\" :key=\"item.id\">\r\n            <span class=\"course-left\">第{{index+1}}节课</span>\r\n            <div class=\"course-right\">\r\n                <el-time-select\r\n                    v-model=\"startTime[index]\"\r\n                    :min-time=\"index==0?'7:55':(endTime[index-1]?endTime[index-1]:'8:00')\"\r\n                    :max-time=\"endTime[index]\"\r\n                    :start=\"index==0?'8:00':(endTime[index-1]?endTime[index-1]:'8:00')\"\r\n                    placeholder=\"上课时间\"\r\n                    step=\"00:05\"\r\n                    end=\"22:30\"\r\n                    />-\r\n                <el-time-select\r\n                    v-model=\"endTime[index]\"\r\n                    :min-time=\"startTime[index]\"\r\n                    :max-time=\"startTime[index+1]\"\r\n                    :start=\"startTime[index]?startTime[index]:'8:00'\"\r\n                    placeholder=\"下课时间\"\r\n                    step=\"00:05\"\r\n                    end=\"23:30\"\r\n                    />\r\n                <el-button @click=\"addCourse(index)\">增加一节课</el-button>\r\n                <el-button @click=\"deleteCourse(index)\">删除这节课</el-button>\r\n                <el-button @click=\"test(index)\">test</el-button>\r\n            </div>\r\n        </div>\r\n        <div class=\"class-container\">\r\n            <h2>上课教室设置</h2>\r\n            <el-input\r\n                v-model=\"newRoom\"\r\n                placeholder=\"教室号\"\r\n                class=\"input-with-select\"\r\n                style=\"width:70%\"\r\n                >\r\n                <template #prepend>\r\n                    <el-select v-model=\"newClassroom\" placeholder=\"教学楼\" value-key=\"name\" style=\"width: 150px\">\r\n                        <el-option v-for=\"(building) in buildings\" :key=\"building.name\" :value=\"building\" :label=\"building.name\"  />\r\n                    </el-select>\r\n                </template>\r\n                <template #append>\r\n                    <section style=\"width: 80px\"> {{newClassroom.aka}}{{newRoom}} </section>\r\n                    \r\n                </template>\r\n            </el-input>\r\n            <el-input v-model=\"newCap\" placeholder=\"教室容量\" style=\"width:30%\"/>\r\n\r\n            <el-button @keydown=\"addClassroom\" @click=\"addClassroom\">添加新教室</el-button>\r\n        </div>\r\n        <div class=\"classroom-container\">\r\n            <el-card \r\n                class=\"box-card\"\r\n                v-for=\"(building, index) in classroom\"\r\n                :key=\"building.name\"\r\n                >\r\n                <template #header>\r\n                <div class=\"card-header\">\r\n                    <span>{{building.name}}</span>\r\n                    <el-button class=\"button\" type=\"text\" v-if=\"!onDeleteAll\" @click=\"checkDelete(index)\">清空教学楼内教室</el-button>\r\n                </div>\r\n                </template>\r\n                <el-scrollbar height=\"200px\" class=\"card-item-container\"> \r\n                    <el-button v-if=\"!onDelete[index] && !onDeleteAll\" class=\"button\" type=\"text\" @click=\"openDelete(index)\">删除教室</el-button>\r\n                    <el-button v-if=\"onDelete[index]\" class=\"button2\" type=\"text\" @click=\"submitDelete(index)\">确认删除选中教室</el-button>\r\n                    <el-button v-if=\"onDelete[index]\" class=\"button2\" type=\"text\" @click=\"cancelDelete(index)\">取消删除</el-button>\r\n                    <div class=\"hold-place\" v-if=\"onDeleteAll && !onDelete[index]\"> </div>\r\n                    <div v-if=\"!onDelete[index]\" class=\"card-item-div-container\">\r\n                        <div class=\"card-item\" v-for=\"room in building.room\" :key=\"room\">{{building.aka}}{{room}}</div>\r\n                    </div> \r\n                    <div v-for=\"(room,index2) in checkGroup\" \r\n                            :key=\"room.name\" \r\n                            class=\"card-item\" >\r\n                        <el-checkbox \r\n                            v-if=\"onDelete[index]\"\r\n                            v-model=\"checkGroup[index2].status\" \r\n                            :label='building.aka+checkGroup[index2].name' \r\n                            />\r\n                    </div>\r\n                </el-scrollbar>\r\n\r\n            </el-card>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios'\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nexport default {\r\n    data() {\r\n        return {\r\n\r\n            courseOpen: true,\r\n            courseStatus: '0',\r\n            onDeleteAll: false,//是否有card进入删除状态\r\n            onDelete: [false],//特定card是否进入删除教室状态\r\n            checkGroup: [],\r\n            startTime:[],\r\n            endTime:[],\r\n            newRoom:'',//存放input输入的教室号\r\n            newCap:'',//存放input输入的教室容量\r\n            newClassroom: {\r\n                name: '',\r\n                aka: '',\r\n                room: [],\r\n            },//存档select选择的教学楼\r\n            classroom: [\r\n                {\r\n                    name: '第三教学楼',\r\n                    aka: 'H3',\r\n                    room: [\r\n                        {name:'301', capacity:'120'},\r\n                        {name:'402', capacity:'120'}\r\n                    ]\r\n                },\r\n                {\r\n                    name: '光华楼西辅楼',\r\n                    aka: 'HGX',\r\n                    room: [\r\n                        {name:'201', capacity:'110'},\r\n                        {name:'502', capacity:'100'}\r\n                    ]\r\n                },\r\n            ],//存放所有的教学楼及教室号信息\r\n            buildings: [\r\n                {id:1,name: '第三教学楼', aka: 'H3'},\r\n                {id:2,name: '第四教学楼', aka: 'H4'},\r\n                {id:3,name: '光华楼西辅楼', aka: 'HGX'},\r\n                {id:4,name: '第五教学楼', aka: 'H5'},\r\n                {id:5,name: '第六教学楼', aka: 'H6'},\r\n            ]\r\n        }\r\n    },\r\n    methods: {\r\n        courseChange() {\r\n            axios.post('http://localhost:8081/affair/curriculaVariable',null,{params:{choice:!this.courseOpen}})\r\n            ElMessage({\r\n                type: 'success',\r\n                message: '修改完成',\r\n            })\r\n            console.log(this.courseStatus)\r\n        },\r\n        deleteCourse(index) {\r\n            this.startTime.splice(index,1)\r\n            this.endTime.splice(index,1)\r\n        },\r\n        addCourse(index) {\r\n            this.startTime.splice(index+1,0,'')\r\n            this.endTime.splice(index+1,0,'')\r\n        },\r\n\r\n        async addClassroom() {\r\n            if(this.newRoom === '') {\r\n                alert('教室号不能为空')\r\n                return\r\n            }\r\n            if(this.newClassroom.name == '') {\r\n                alert('教学楼不能为空')\r\n                return\r\n            }\r\n            if(this.newCap === '') {\r\n                alert('教室容量不能为空')\r\n                return\r\n            }\r\n            if(!(/^[1-9]\\d*$/.test(this.newCap))) {\r\n                alert('教室容量为正整数')\r\n                return\r\n            }\r\n            var i;\r\n            i = this.classroom.findIndex((building) => building.name == this.newClassroom.name)//寻找classroom已有的教学楼中是否有newClassroom中的教学楼 \r\n            if(i >= 0) {\r\n                if(this.classroom[i].room.indexOf(this.newRoom) > -1) {\r\n                    alert('教室已存在，请勿重复添加')\r\n                    this.newRoom = ''\r\n                    return\r\n                }\r\n                await axios.post('http://localhost:8081/affair/room/new', {building: this.newClassroom.aka, roomNum: this.newRoom})\r\n                .then(res => {\r\n                    console.log(res)\r\n                    this.classroom[i].room.push(this.newRoom) \r\n                    this.classroom[i].room.sort((a, b) => {\r\n                        if(a.length < b.length) return -1\r\n                        else if(a.length > b.length) return 1\r\n                        else return a.localeCompare(b)   \r\n                    }) //将教室号排序\r\n                })\r\n                \r\n            } \r\n            else {\r\n                await axios.post('http://localhost:8081/affair/room/new', {building: this.newClassroom.aka, roomNum: this.newRoom})\r\n                .then(res => {\r\n                    console.log(res)\r\n                    this.newClassroom.room=[]\r\n                    this.newClassroom.room.push(this.newRoom)\r\n                    this.classroom.push(this.newClassroom)\r\n                })\r\n\r\n            }\r\n            this.newRoom = ''\r\n        },\r\n        checkDelete(index) {\r\n            ElMessageBox.confirm(\r\n                '是否删除教学楼‘' + this.classroom[index].name+'’内的全部教室',\r\n                'Warning',\r\n                {\r\n                    confirmButtonText: '确认',\r\n                    cancelButtonText: '取消',\r\n                    type: 'warning',\r\n                }\r\n            )\r\n            .then(() => {\r\n                this.deleteBuilding(index)\r\n                ElMessage({\r\n                    type: 'success',\r\n                    message: '删除成功',\r\n                })\r\n                })\r\n            .catch(() => {\r\n                ElMessage({\r\n                    type: 'info',\r\n                    message: '删除取消',\r\n                })\r\n            })\r\n        },\r\n        deleteBuilding(index) {\r\n            axios.delete('http://localhost:8081/affair/building/rooms', {data:{fullName: this.classroom[index].name, abbrName: this.classroom[index].aka}})\r\n            this.classroom.splice(index, 1)\r\n        },\r\n        openDelete(index) {\r\n            this.onDeleteAll = true\r\n            this.onDelete[index] = true\r\n            this.checkGroup = []\r\n            for(let i in this.classroom[index].room) {\r\n                this.checkGroup.push({name:this.classroom[index].room[i], status: false})\r\n            }\r\n            console.log(this.checkGroup)\r\n            \r\n        },\r\n        async submitDelete(index) {\r\n            this.onDelete[index] = false\r\n            this.onDeleteAll = false\r\n            for(let i = 0; i < this.checkGroup.length; i++) {\r\n                if(this.checkGroup[i].status) {\r\n                    await axios.delete('http://localhost:8081/affair/room', {data:{building: this.classroom[index].aka, roomNum: this.classroom[index].room[i]}})\r\n                    .then(res => {\r\n                        console.log(res)\r\n                        this.classroom[index].room.splice(i, 1)\r\n                        this.checkGroup.splice(i, 1)\r\n                    })\r\n                    .catch(err => {\r\n                        console.dir(err)\r\n                    })\r\n                    i=i-1\r\n                }\r\n            }\r\n            this.checkGroup = []\r\n        },\r\n        cancelDelete(index) {\r\n            this.onDelete[index] = false\r\n            this.onDeleteAll = false\r\n            this.checkGroup = [] \r\n        },\r\n        test(index) {\r\n            // console.log(this.startTime)\r\n            console.log(index)\r\n            console.log(this.newClassroom)\r\n            console.log(this.classroom)\r\n        },\r\n        submitCourse() {\r\n            let times = []\r\n            for(let i = 0; i < this.startTime.length; i++) {\r\n                if(this.startTime[i] == '' || this.endTime[i] == '') {\r\n                    alert('请填写完所有上课时间后提交')\r\n                    return\r\n                }\r\n                times.push({name: '第'+parseInt(i+1)+'节', startTime: this.startTime[i], endTime: this.endTime[i]})\r\n            }\r\n            axios.post('http://localhost:8081/affair/times', times)\r\n            .then(res => {\r\n                console.log(res)\r\n                ElMessage({\r\n                    type: 'success',\r\n                    message: '提交成功',\r\n                })\r\n            })\r\n        }\r\n    },\r\n    async created() {\r\n         //获取选课状态\r\n        axios.get('http://localhost:8081/user/curriculaVariable')\r\n        .then(res => {\r\n            this.courseStatus = res.data.data1\r\n        })\r\n        .catch(error => {\r\n            console.dir(error)\r\n        })\r\n        //获取所有教学楼\r\n        axios.get('http://localhost:8081/affair/building')\r\n        .then(res => {\r\n            this.buildings = res.data.data1\r\n            for(let i = 0; i < this.buildings.length; i++) {\r\n                this.buildings[i] = JSON.parse(JSON.stringify(this.buildings[i]).replace(/fullName/g,\"name\"))\r\n                this.buildings[i] = JSON.parse(JSON.stringify(this.buildings[i]).replace(/abbrName/g,\"aka\"))\r\n            }\r\n        })\r\n        await axios.get('http://localhost:8081/affair')\r\n        .then(res => {\r\n            console.log(res)\r\n            //获取教室信息\r\n            let classrooms = res.data.data1\r\n            this.classroom = []\r\n            for(let i = 0; i < classrooms.length; i++) {\r\n                this.classroom.push({name:classrooms[i].fullName, aka:classrooms[i].abbrName, room:[]})\r\n                for(let j = 0; j < classrooms[i].room.length; j++) {\r\n                    this.classroom[i].room.push({name:classrooms[i].room[j].roomNum, capacity:classrooms[i].room[j].capacity})\r\n                }\r\n            }\r\n            //获取上课时间信息\r\n            let classTime = res.data.data2\r\n            this.startTime = []\r\n            this.endTime = []\r\n            for(let i = 0; i < classTime.length; i++) {\r\n                this.startTime.push(classTime[i].startTime)\r\n                this.endTime.push(classTime[i].endTime)\r\n            }\r\n           \r\n            \r\n        })\r\n    }\r\n}\r\n</script>\r\n\r\n<style >\r\n.el-card__body {\r\n    padding-top: 10px;\r\n}\r\n.card-item-container .el-scrollbar__view {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    justify-content:space-between;\r\n}\r\n.card-item-div-container {\r\n    width: 236px;\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    justify-content:space-between;\r\n\r\n}\r\n.card-item-container .button{\r\n    width: 100%;\r\n}\r\n.card-item-container .button2{\r\n    width: 50%;\r\n    margin: 0px;\r\n\r\n}\r\n.card-item {\r\n    font-size: 16px;\r\n    width: 50%;\r\n}\r\n.card-item .el-checkbox__label {\r\n    font-size: 16px;\r\n}\r\n.card-item-container .hold-place {\r\n    width: 100%;\r\n    height: 14px;\r\n    padding: 8px;\r\n    margin: 1px;\r\n}\r\n.classroom-container {\r\n    width: 1200px;\r\n    margin: auto;\r\n    display: flex;\r\n    flex-wrap:wrap;\r\n    justify-content:flex-start;\r\n}\r\n.card-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n}\r\n\r\n.text {\r\n    font-size: 14px;\r\n}\r\n.box-card {\r\n    margin: 0.9%;\r\n    height: 300px;\r\n\r\n    width: 23%;\r\n}\r\n\r\n.course-container {\r\n    display: flex;\r\n    margin: auto;\r\n    justify-content:center\r\n}\r\n.course-left{\r\n    flex: 0;\r\n    margin-left:200px;\r\n    min-width: 100px;\r\n    padding-right:auto;\r\n    /* padding-bottom:20px; */\r\n    padding-left: auto;\r\n    margin:10px;\r\n    text-align:right;\r\n}\r\n.course-right{\r\n    max-width:800px;\r\n    flex: 1;\r\n}\r\n.class-container {\r\n    width: 600px;\r\n    margin: auto;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}